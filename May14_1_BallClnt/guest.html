<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script src="http://localhost:5678/socket.io/socket.io.js"></script>
        <script src="jQuery.js"></script>
        <script>
            $(function() {
                var socket = io.connect("http://localhost:5678");
                var paper = document.getElementById("c1");
                var pen = paper.getContext("2d");

                var p1X = 150;
                var p2X = 150;
                $("#c1").mousemove(function(e) {
                    p2X = e.pageX - 58;
                    socket.emit("drawP2", p2X);
                });

                socket.emit("p2Enter");

                var ball = new Image();
                ball.src = "ball.png";
                var t;
                var x = 185;
                var y = 285;
                var vx = 2;
                var vy = 2;

                pen.save()
                pen.fillStyle = "#000000"
                pen.fillRect(0, 0, 400, 600);
                pen.fillStyle = "red";
                pen.fillRect(p1X, 590, 100, 10);
                pen.fillStyle = "blue";
                pen.fillRect(p2X, 0, 100, 10);
                pen.restore();

                socket.on("drawP1onP2", function(x) {
                    p1X = 300 - x;
                });

                socket.on("drawBallConfirm", function(xy) {
                    x = 370 - xy.x;
                    y = 570 - xy.y;
                });

                socket.on("gameStartConfirm", function() {
                    t = setInterval(function() {
                        if (y >= 570) {
                            $("h1").text("You lose");
                            clearInterval(t);
                        }
                        if (y <= 0) {
                            $("h1").text("You win");
                            clearInterval(t);
                        }
                        pen.save()
                        pen.fillStyle = "#00000011"
                        pen.fillRect(0, 0, 400, 600);
                        pen.fillStyle = "blue";
                        pen.fillRect(p2X, 590, 100, 10);
                        pen.fillStyle = "red";
                        pen.fillRect(p1X, 0, 100, 10);
                        pen.restore();
                        pen.drawImage(ball, x, y, 30, 30);
                    }, 0);
                });
            });
        </script>
        <style>
            
        </style>
    </head>
    <body>
        <canvas id="c1" width="400px" height="600px"></canvas>
        <h1></h1>
    </body>
</html>